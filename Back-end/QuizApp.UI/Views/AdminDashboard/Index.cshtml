@model IEnumerable<AdminQuizDashboardViewModel>
@{
    ViewData["Title"] = "Admin Dashboard";
    Layout = "_AdminLayout";
}

<div class="container mt-4">
    <h2 class="mb-4">📊 Admin Dashboard</h2>

    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>Quiz Title</th>
                <th>Total Attempts</th>
                <th>Unique Users</th>
                <th>Highest Scorer</th>
                <th>Highest Score</th>
                <th>Average Score</th>
                <th>Most Difficult Question</th>
                <th>Correct %</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@item.Title</td>
                    <td>@item.TotalAttempts</td>
                    <td>@item.UserCount</td>
                    <td>@item.HighestScorerName</td>
                    <td>@item.HighestScore</td>
                    <td>@item.AverageScore.ToString("0.0")</td>
                    <td>@item.MostDifficultQuestion</td>
                    <td>@item.DifficultQuestionAccuracy.ToString("0.0")%</td>
                </tr>
            }
        </tbody>
    </table>
</div>
<hr />
<canvas id="quizChart"></canvas>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const labels = @Html.Raw(Json.Serialize(Model.Select(x => x.Title)));
        const avgScores = @Html.Raw(Json.Serialize(Model.Select(x => x.AverageScore)));
        const highestScores = @Html.Raw(Json.Serialize(Model.Select(x => x.HighestScore)));

        new Chart(document.getElementById('quizChart'), {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    { label: 'Average Score', data: avgScores },
                    { label: 'Highest Score', data: highestScores }
                ]
            },
        });
    </script>
}

